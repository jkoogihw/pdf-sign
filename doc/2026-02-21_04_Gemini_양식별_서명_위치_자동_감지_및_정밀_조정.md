# 2026-02-21_04_Gemini_양식별_서명_위치_자동_감지_및_정밀_조정.md

## 1. 개요
- 보험 양식(장기, 일반, 자동차)에 따라 서로 다른 서명 기준 키워드를 자동으로 인식하고, 서명 이미지의 위치를 `(서명/인)` 문구 위에 정밀하게 정렬하도록 로직을 고도화함.

## 2. 주요 개선 사항

### 2.1. 양식 자동 판별 (Form Detection)
- 문서 1페이지의 전체 텍스트를 분석하여 보험 종류를 판별함.
    - **장기**: "보험상품 비교 설명 확인서" 키워드 매칭
    - **일반**: "일반보험상품 비교 설명 확인서" 키워드 매칭
    - **자동차**: "자동차보험상품 비교 설명 확인서" 키워드 매칭

### 2.2. 동적 기준점(Anchor) 검색
- 판별된 양식에 따라 서명 위치를 찾기 위한 첫 번째 기준 키워드를 변경함.
    - **장기**: `보험모집인`
    - **일반/자동차**: `설계사`

### 2.3. 맥락 기반 정밀 탐색 (Context-Aware Search)
- 단순 키워드 매칭이 아닌 지리학적 동질성을 기반으로 탐색함.
    1. 기준 키워드(`보험모집인`/`설계사`)의 Y축 좌표를 확보.
    2. 동일한 높이(Y축 오차 범위 5pt 이내)에 있는 텍스트 중 우측에 있는 `(서명/인)` 토큰을 최종 서명 좌표로 결정.

### 2.4. 기하학적 중앙 정렬 (Geometric Alignment) 보정
- 텍스트 영역의 가로/세로 중앙과 서명 이미지의 중앙을 완벽하게 일치시킴.
    - **가로(X)**: `텍스트 시작점 + (텍스트 너비 / 2) - (이미지 너비 / 2)`
    - **세로(Y)**: `텍스트 Baseline + 글자 높이 절반 - (이미지 높이 / 2)`
- 위 수식을 통해 스크린샷 피드백에서 나타났던 우측 상단 치우침 현상을 근본적으로 해결함.

### 2.5. UI/UX 개선
- **기본 크기 상향**: 서명 이미지 기본 너비를 `64pt`에서 `120pt`로 조정하여 가독성 확보.
- **상태 메시지**: 작업 완료 시 감지된 양식(예: `[자동차]`)을 명시하여 시스템의 판단 결과를 사용자에게 피드백함.

## 3. 실행 및 검증 명령어
```powershell
# 포트 8080 점유 프로세스 정리 후 재시작
taskkill /F /IM powershell.exe /T
powershell -ExecutionPolicy Bypass -File .\server.ps1
```

## 4. 최종 결과
- 사용자가 제공한 3가지 양식에 대해 별도의 설정 없이도 서명 위치를 정확하게 찾아 배치함.
- `(서명/인)` 문구 정중앙에 서명이 중첩되어 실제 날인한 것과 같은 효과를 구현함.
